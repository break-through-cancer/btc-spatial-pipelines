nextflow_pipeline {

    name "Test Workflow main.nf"
    script "main.nf"

    test("RCTD on Visium SD with reference as URL") {

        when {
            params {
                input = "../../../tests/test.csv"
                outdir = "tests/results"
                max_memory = "8.GB"
                max_cpus = 4
                reference_scrna = "https://datasets.cellxgene.cziscience.com/6c29f947-d85b-483e-b346-b163277dae5e.h5ad"
            }
        }

        then {
            assert workflow.success
        }

    }

    test("RCTD on Visium HD with reference as URL") {

        when {
            params {
                input = "../../../tests/hdtest.csv"
                outdir = "tests/results"
                max_memory = "8.GB"
                max_cpus = 4
                reference_scrna = "https://datasets.cellxgene.cziscience.com/6c29f947-d85b-483e-b346-b163277dae5e.h5ad"
                hd = "square_016um"
            }
        }

        then {
            assert workflow.success
        }

    }

}
